{% extends 'base/detached-layout/datables.html' %}
{% load static %}

{% block nav_content %}
<!-- start page title -->
<div class="row">
    <div class="col-12">
        <div class="page-title-box">
            <div class="page-title-right">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="javascript: void(0);">Authentication</a></li>
                    <li class="breadcrumb-item">User Account</li>
                    <li class="breadcrumb-item">{{request.user.get_full_name}}</li>
                </ol>
            </div>
            <h4 class="page-title">{{title}}</h4>
        </div>
    </div>  
</div>     

{% endblock nav_content %}


{% block table-content %}

<div class="row">
    <div class="col-sm-12">
        <!-- Profile -->
        <div class="alert alert-dismissible border-0 fade show fade d-none" role="alert" id="upload_profile_pic">
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            <div id="upload_profile_pic_msg"></div>
        </div>

        <div class="alert alert-danger alert-dismissible border-0 fade d-none" role="alert" id="access_admin_site">
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            You dont have access to visit <strong>Administrator Site</strong>.
        </div>

        <div class="card bg-primary">
            <div class="card-body profile-user-box">
                <div class="row">
                    <div class="col-sm-8">
                        <div class="row align-items-center">
                            <div class="col">
                                <div>
                                    <h4 class="mt-1 mb-1 text-white">{{request.user.get_full_name}}</h4>
                                    <p class="font-13 text-white">Login as {{users_groups}}</p>

                                    <ul class="mb-0 list-inline text-light">
                                        <li class="list-inline-item me-3">
                                            <h5 class="mb-1 font-13 text-white">{{request.user.username}}</h5>
                                            <p class="mb-0 font-13 text-white-50">Username Account</p>
                                        </li>
                                        <li class="list-inline-item">
                                            <h5 class="mb-1 font-13 text-white">{{request.user.email}}</h5>
                                            <p class="mb-0 font-13 text-white-50">Email Account</p>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div> <!-- end col-->

                    <div class="col-sm-4">
                        <div class="text-center mt-sm-0 mt-3 text-sm-end">
                            {% if user.is_staff  %}
                                <a class="btn btn-light btn-disabled" href="/admin">
                                    <i class="mdi mdi-account-edit me-1"></i>Administrator Site
                                </a>
                            {% else %}
                                <button type="button" class="btn btn-light btn-disabled" id="toggleAlert">
                                    <i class="mdi mdi-account-edit me-1"></i>Administrator Site
                                </button>
                            {% endif %}


                        </div>
                    </div> <!-- end col-->
                </div> <!-- end row -->

            </div> <!-- end card-body/ profile-user-box-->

            <div class="card-footer">
                <div class="row mt-2">
                    <div class="col-md-4">
                        <form action="{% url 'auth:user-account' %}" id="profile-picture">
                            {% csrf_token %}
                            <div class="mb-3">
                                <label for="{{form.image.id_for_label}}" class="form-label">{{ form.image.label }}</label>
                                {{form.image}}
                            </div>
                            <button type="submit" class="btn btn-primary btn-sm">Upload Picture</button>
                        </form>
                       
                    </div>
                </div>
            </div>
        </div><!--end profile/ card -->

    </div> <!-- end col-->
</div>
<!-- end row -->

{% endblock table-content %}

{% block tables-script-extend %}

<script>
    $('#toggleAlert').click(function(){
   
        $('#access_admin_site').removeClass('d-none')
        $('#access_admin_site').addClass('show')
    })

    $('#profile-picture').submit(function(e){

        e.preventDefault();
        var data = new FormData();
        data.append("image", $('#id_image').get(0).files[0])

        $.ajax({
            url: '{% url 'auth:user-account' %}',
            type: 'POST',
            data: data,
            processData: false,
            contentType: false,
            headers: {
                "X-Requested-With": "XMLHttpRequest",
                "X-CSRFToken": '{{csrf_token}}',
            },
            success: function (data) {
                if (data.status == 'success'){
                    $('#upload_profile_pic').addClass('alert-success')
                    $('#upload_profile_pic').removeClass('alert-danger')
                    $('#upload_profile_pic').removeClass('d-none')
                    $('#upload_profile_pic_msg').html(data.message)
                    location.reload();
                }else{
                    $('#upload_profile_pic').removeClass('alert-success')
                    $('#upload_profile_pic').addClass('alert-danger')
                    $('#upload_profile_pic').removeClass('d-none')
                    $('#upload_profile_pic_msg').html(data.message)
                }
            },
            error: function (xhr, status, error) {
                return console.log(xhr.responseText['messages'])
            }
        })

    })
</script>
{% endblock tables-script-extend %}